<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéµ</text></svg>">
    <title>Sound-Responsive Fireworks with Custom Images</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/image-uploader.css">
    <link rel="stylesheet" href="css/background-uploader.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/settings.css">
    <link rel="stylesheet" href="css/uploaders.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/mobile-responsive.css">
    
</head>
<body>
    <canvas id="animationCanvas"></canvas>
    
    <div class="app-container">
        <div class="control-panel">
            <button id="startMicrophone" class="mic-button">
                <span class="icon">üé§</span>
                <span class="text">Start</span>
            </button>
            <button id="testFirework" class="test-button">
                <span class="icon">üéÜ</span>
                <span class="text">Test</span>
            </button>
            <button id="toggleSettings">
                <span class="icon">‚öôÔ∏è</span>
                <span class="text">Settings</span>
            </button>
            <button id="togglePanels">
                <span class="icon">üëÅÔ∏è</span>
                <span class="text">Hide</span>
            </button>
        </div>
        
        <!-- Tabbed Uploader Interface -->
        <div class="uploader-tabs-container">
            <div class="uploader-tab-navigation">
                <button class="uploader-tab-button active" data-uploader-tab="firework">Firework Images</button>
                <button class="uploader-tab-button" data-uploader-tab="background">Background Images</button>
            </div>
            
            <div class="uploader-tab-content">
                <div class="uploader-tab-pane active" id="firework-tab">
                    <div class="image-upload-container">
                        <div class="upload-area" id="dropZone">
                            <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
                            <div class="upload-content">
                                <p>Drag and drop custom images here</p>
                                <p>or</p>
                                <button id="selectFiles" class="button">Select Files</button>
                                <p class="file-types">Supported: JPG, PNG, GIF (max 5MB)</p>
                            </div>
                        </div>
                        <div class="preview-container" id="previewContainer"></div>
                    </div>
                </div>
                
                <div class="uploader-tab-pane" id="background-tab">
                    <div class="image-upload-container">
                        <div class="upload-area" id="bgDropZone">
                            <input type="file" id="bgFileInput" accept="image/*" multiple style="display: none;">
                            <div class="upload-content">
                                <p>Drag and drop background images here</p>
                                <p>or</p>
                                <button id="selectBgFiles" class="button">Select Files</button>
                                <p class="file-types">Supported: JPG, PNG, GIF (max 5MB)</p>
                            </div>
                        </div>
                        
                        <div class="preview-container" id="bgPreviewContainer"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="audio-visualizer">
            <div id="volumeLevel" class="volume-meter">
                <div class="level-bar"></div>
            </div>
            <div id="audioStatus">Audio status: inactive</div>
            <div class="mic-test">
                <p>Make LOUDER, SUSTAINED sounds to launch fireworks. Keep making sound to keep them rising. VERY LOUD sounds will BURST all active fireworks! üîä</p>
                <div id="micDetection" class="mic-detection">Make LOUDER, SUSTAINED sound to start fireworks</div>
            </div>
        </div>
    </div>
    
    <!-- Settings panel with tabs -->
    <div id="settingsPanel" class="settings-panel" style="display: none;">
        <h2>Sound & Animation Settings</h2>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation" role="tablist">
            <button class="tab-button" data-tab="audio" role="tab">Audio</button>
            <button class="tab-button" data-tab="fireworks" role="tab">Fireworks</button>
            <button class="tab-button" data-tab="particles" role="tab">Particles</button>
            <button class="tab-button" data-tab="effects" role="tab">Effects</button>
            <button class="tab-button" data-tab="colors" role="tab">Colors</button>
            <button class="tab-button" data-tab="backgroundCtrl" role="tab">Background</button>
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Audio Tab Pane -->
            <div class="tab-pane" id="audio-tab" data-tab-content="audio">
                <h4>Audio Settings</h4>
                <div class="setting">
                    <label for="sensitivitySlider">Microphone Sensitivity: <span id="sensitivityValue">2.0</span></label>
                    <input type="range" id="sensitivitySlider" min="0.5" max="4" step="0.1" value="2.0">
                    <p class="setting-description">Higher values make the microphone more sensitive to sound.</p>
                </div>
                <div class="setting">
                    <label for="thresholdLow">Quiet Threshold: <span id="thresholdLowValue">0.08</span></label>
                    <input type="range" id="thresholdLow" min="0.02" max="0.2" step="0.01" value="0.08">
                    <p class="setting-description">Minimum sound level to launch fireworks (sustained sounds).</p>
                </div>
                <div class="setting">
                    <label for="thresholdHigh">Loud Threshold: <span id="thresholdHighValue">0.4</span></label>
                    <input type="range" id="thresholdHigh" min="0.1" max="1" step="0.05" value="0.4">
                    <p class="setting-description">Sound level to explode all fireworks (loud bursts).</p>
                </div>
                <div class="setting">
                    <label for="suddenThreshold">Sudden Sound Threshold: <span id="suddenThresholdValue">0.12</span></label>
                    <input type="range" id="suddenThreshold" min="0.05" max="0.3" step="0.01" value="0.12">
                    <p class="setting-description">Minimum increase in sound to detect a 'sudden' sound for effects.</p>
                </div>
            </div>

            <!-- Fireworks Tab Pane -->
            <div class="tab-pane" id="fireworks-tab" data-tab-content="fireworks">
                <h4>Fireworks Settings</h4>
                <div class="setting">
                    <label for="fireworkGravity">Gravity: <span id="gravityValue">0.02</span></label>
                    <input type="range" id="fireworkGravity" min="0.01" max="0.2" step="0.005" value="0.02">
                    <p class="setting-description">Controls how quickly fireworks fall.</p>
                </div>
                <div class="setting">
                    <label for="maxFireworks">Max Fireworks: <span id="maxFireworksValue">15</span></label>
                    <input type="range" id="maxFireworks" min="1" max="50" step="1" value="15">
                    <p class="setting-description">Maximum number of fireworks on screen simultaneously.</p>
                </div>
                <div class="setting">
                    <label for="launchHeight">Launch Height Factor: <span id="launchHeightValue">10</span></label>
                    <input type="range" id="launchHeight" min="10" max="100" step="10" value="10">
                    <p class="setting-description">Multiplier for how high fireworks are launched.</p>
                </div>
                <div class="setting">
                    <label for="smokeTrailIntensity">Smoke Trail Intensity: <span id="smokeTrailValue">0.3</span></label>
                    <input type="range" id="smokeTrailIntensity" min="0" max="1" step="0.05" value="0.3">
                    <p class="setting-description">Opacity of the smoke trail behind fireworks.</p>
                </div>
                <div class="setting">
                    <label for="fireworkSize">Firework Size: <span id="fireworkSizeValue">1.0</span></label>
                    <input type="range" id="fireworkSize" min="0.5" max="5.0" step="0.1" value="1.0">
                    <p class="setting-description">Controls the size of fireworks and uploaded images during explosions.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="randomFireworkSize">Random Firework Sizes:</label>
                    <label class="switch">
                        <input type="checkbox" id="randomFireworkSize">
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">When enabled, each firework will have a random size within the specified range.</p>
                </div>
                <div class="setting" id="randomSizeRange" style="display: none;">
                    <label for="randomSizeMin">Random Size Min: <span id="randomSizeMinValue">0.5</span></label>
                    <input type="range" id="randomSizeMin" min="0.5" max="2.0" step="0.1" value="0.5">
                    <p class="setting-description">Minimum size for random fireworks.</p>
                </div>
                <div class="setting" id="randomSizeMaxSetting" style="display: none;">
                    <label for="randomSizeMax">Random Size Max: <span id="randomSizeMaxValue">2.0</span></label>
                    <input type="range" id="randomSizeMax" min="2.0" max="5.0" step="0.1" value="2.0">
                    <p class="setting-description">Maximum size for random fireworks.</p>
                </div>
            </div>

            <!-- Particles Tab Pane -->
            <div class="tab-pane" id="particles-tab" data-tab-content="particles">
                <h4>Particle Settings</h4>
                <div class="setting">
                    <label for="particleCount">Particle Count: <span id="particleCountValue">100</span></label>
                    <input type="range" id="particleCount" min="10" max="500" step="10" value="100">
                    <p class="setting-description">Number of particles per firework explosion.</p>
                </div>
                <div class="setting">
                    <label for="particleLifespan">Particle Lifespan (frames): <span id="particleLifespanValue">60</span></label>
                    <input type="range" id="particleLifespan" min="20" max="200" step="5" value="60">
                    <p class="setting-description">How long particles last before fading.</p>
                </div>
                <div class="setting">
                    <label for="particleMinSize">Min Particle Size: <span id="particleMinSizeValue">1</span></label>
                    <input type="range" id="particleMinSize" min="0.5" max="5" step="0.1" value="1">
                    <p class="setting-description">Minimum size of individual particles.</p>
                </div>
                <div class="setting">
                    <label for="particleMaxSize">Max Particle Size: <span id="particleMaxSizeValue">3</span></label>
                    <input type="range" id="particleMaxSize" min="1" max="10" step="0.1" value="3">
                    <p class="setting-description">Maximum size of individual particles.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="useMultiColor">Use Multicolor Particles:</label>
                    <label class="switch">
                         <input type="checkbox" id="useMultiColor">
                         <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Particles use a variety of colors if enabled.</p>
                </div>
            </div>

            <!-- Effects Tab Pane -->
            <div class="tab-pane" id="effects-tab" data-tab-content="effects">
                <h4>Visual Effects Settings</h4>
                <div class="setting toggle-setting">
                    <label for="imageRotation">Image Rotation:</label>
                    <label class="switch">
                        <input type="checkbox" id="imageRotation">
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Enable or disable image rotation during explosions.</p>
                </div>
                <div class="setting">
                    <label for="imageGravity">Image Gravity Strength: <span id="imageGravityValue">1.0</span></label>
                    <input type="range" id="imageGravity" min="0" max="3" step="0.1" value="1.0">
                    <p class="setting-description">How strongly gravity affects falling images after explosion (0 = no gravity, higher = faster falling).</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="glowEffect">Glow Effect:</label>
                    <label class="switch">
                        <input type="checkbox" id="glowEffect">
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Adds a glow to fireworks and particles.</p>
                </div>
                <div class="setting">
                    <label for="fadeResistance">Fade Resistance: <span id="fadeResistanceValue">0.95</span></label>
                    <input type="range" id="fadeResistance" min="0.8" max="0.99" step="0.01" value="0.95">
                    <p class="setting-description">How slowly particles fade (higher is slower).</p>
                </div>
                <div class="setting">
                    <label for="globalSpeed">Global Animation Speed: <span id="globalSpeedValue">1</span></label>
                    <input type="range" id="globalSpeed" min="0.1" max="2" step="0.1" value="1">
                    <p class="setting-description">Overall speed of all animations.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="testSoundEnabled">Test Firework Sounds:</label>
                    <label class="switch">
                        <input type="checkbox" id="testSoundEnabled" checked>
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Enable launch and burst sounds for test fireworks.</p>
                </div>
                <div class="setting">
                    <label for="testSoundVolume">Sound Volume: <span id="testSoundVolumeValue">0.3</span></label>
                    <input type="range" id="testSoundVolume" min="0" max="1" step="0.05" value="0.3">
                    <p class="setting-description">Volume for test firework sound effects.</p>
                </div>
            </div>

            <!-- Colors Tab Pane -->
            <div class="tab-pane" id="colors-tab" data-tab-content="colors">
                <h4>Color Settings</h4>
                <div class="setting">
                    <label for="colorTheme">Color Theme:</label>
                    <select id="colorTheme">
                        <option value="Vivid" selected>Vivid</option>
                        <option value="Pastel">Pastel</option>
                        <option value="Neon">Neon</option>
                        <option value="Earthy">Earthy</option>
                        <option value="Monochrome">Monochrome</option>
                        <option value="Custom">Custom</option>
                    </select>
                    <p class="setting-description">Select a predefined color theme or create a custom one.</p>
                </div>
                <div class="setting">
                    <label for="colorIntensity">Color Intensity: <span id="colorIntensityValue">1</span></label>
                    <input type="range" id="colorIntensity" min="0.1" max="2" step="0.1" value="1">
                    <p class="setting-description">Adjusts the overall vividness of colors.</p>
                </div>
                <div class="setting" id="customColorsSetting" style="display: none;">
                    <h5>Custom Colors</h5>
                    <div class="color-picker-container">
                        <input type="color" id="colorPicker" value="#ff0000">
                        <button id="addColor" class="button">Add Color</button>
                    </div>
                    <p class="setting-description">Click a swatch to remove it.</p>
                    <div id="customColorsList" class="custom-colors-list">
                        <!-- Custom color swatches will be added here by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Background Settings Tab Pane (existing) -->
            <div class="tab-pane" id="backgroundCtrl-tab" data-tab-content="backgroundCtrl">
                <h4>Background Effects Settings</h4>
                <div class="setting">
                    <label for="bgOpacity">Background Opacity: <span id="bgOpacityValue">0.5</span></label>
                    <input type="range" id="bgOpacity" min="0" max="1" step="0.05" value="0.5">
                    <p class="setting-description">Controls the transparency of the background images. 0 is fully transparent, 1 is fully opaque.</p>
                </div>
                <div class="setting">
                    <label for="bgTransitionTime">Transition Time (sec): <span id="bgTransitionValue">2</span></label>
                    <input type="range" id="bgTransitionTime" min="0.5" max="5" step="0.5" value="2">
                    <p class="setting-description">How long it takes for one background image to fade into the next.</p>
                </div>
                <div class="setting">
                    <label for="bgDisplayTime">Display Duration (sec): <span id="bgDisplayValue">5</span></label>
                    <input type="range" id="bgDisplayTime" min="2" max="20" step="1" value="5">
                    <p class="setting-description">How long each background image is shown before transitioning to the next.</p>
                </div>
            </div>
        </div>
        
        <!-- Control Buttons -->
        <div class="settings-controls">
            <button id="resetSettings" class="settings-btn">
                <span class="icon">‚Ü∫</span>
                <span class="text">Reset</span>
            </button>
            <button id="closeSettings" class="settings-btn">
                <span class="icon">‚úì</span>
                <span class="text">Close Settings</span>
            </button>
        </div>
    </div>

    <!-- Tab and button click fixes -->
    
    <!-- Original scripts -->
    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/direct-image-uploader.js"></script>
    <script type="module" src="js/direct-background-uploader.js"></script>
    <script src="js/tab-switcher.js"></script>
    <!-- <script src="js/swatch-fix.js"></script> -->
    <script src="js/settings-swatch-fix.js"></script>
    
    <script>
        // Direct button handlers
        document.addEventListener('DOMContentLoaded', function() {
            const selectFilesBtn = document.getElementById('selectFiles');
            const fileInput = document.getElementById('fileInput');
            
            if (selectFilesBtn && fileInput) {
                selectFilesBtn.onclick = function() {
                    fileInput.click();
                };
            }
            
            const selectBgFilesBtn = document.getElementById('selectBgFiles');
            const bgFileInput = document.getElementById('bgFileInput');
            
            if (selectBgFilesBtn && bgFileInput) {
                selectBgFilesBtn.onclick = function() {
                    bgFileInput.click();
                };
            }
        });
    </script>
</body>
</html>