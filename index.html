<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üéµ</text></svg>">
    <title>Sound-Responsive Fireworks with Custom Images</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/image-uploader.css">
    <link rel="stylesheet" href="css/background-uploader.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/settings.css">
    <link rel="stylesheet" href="css/uploaders.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/mobile-responsive.css">
    <link rel="stylesheet" href="css/presets.css">
    
</head>
<body>
    <!-- FINAL FIX: Animation canvas must be transparent -->
    <canvas id="backgroundCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none;"></canvas>
    <canvas id="animationCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; background: transparent;"></canvas>
    
    <div class="app-container" style="z-index: 10; background: transparent !important;">
        <div class="control-panel">
            <button id="startMicrophone" class="mic-button">
                <span class="icon">üé§</span>
                <span class="text">Start</span>
            </button>
            <button id="testFirework" class="test-button">
                <span class="icon">üéÜ</span>
                <span class="text">Test</span>
            </button>
            <button id="toggleSettings">
                <span class="icon">‚öôÔ∏è</span>
                <span class="text">Settings</span>
            </button>
            <button id="togglePanels">
                <span class="icon">üëÅÔ∏è</span>
                <span class="text">Hide</span>
            </button>
        </div>
        
        <!-- Tabbed Uploader Interface -->
        <div class="uploader-tabs-container">
            <div class="uploader-tab-navigation">
                <button class="uploader-tab-button active" data-uploader-tab="firework">Firework Images</button>
                <button class="uploader-tab-button" data-uploader-tab="background">Background Images</button>
                <button class="uploader-tab-button" data-uploader-tab="presets">Presets</button>
            </div>
            
            <div class="uploader-tab-content">
                <div class="uploader-tab-pane active" id="firework-tab">
                    <div class="image-upload-container">
                        <div class="upload-area" id="dropZone">
                            <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
                            <div class="upload-content">
                                <p>Drag and drop custom images here</p>
                                <p>or</p>
                                <button id="selectFiles" class="button">Select Files</button>
                                <p class="file-types">Supported: JPG, PNG, GIF (max 5MB)</p>
                            </div>
                        </div>
                        <div class="preview-container" id="previewContainer"></div>
                    </div>
                </div>
                
                <div class="uploader-tab-pane" id="background-tab">
                    <div class="image-upload-container">
                        <div class="upload-area" id="bgDropZone">
                            <input type="file" id="bgFileInput" accept="image/*" multiple style="display: none;">
                            <div class="upload-content">
                                <p>Drag and drop background images here</p>
                                <p>or</p>
                                <button id="selectBgFiles" class="button">Select Files</button>
                                <p class="file-types">Supported: JPG, PNG, GIF (max 5MB)</p>
                            </div>
                        </div>
                        
                        <div class="preview-container" id="bgPreviewContainer"></div>
                    </div>
                </div>
                
                <div class="uploader-tab-pane" id="presets-tab">
                    <div class="preset-container">
                        <div class="preset-actions">
                            <button id="discoverPresets" class="button">üîç Discover Presets</button>
                            <button id="loadExternalPreset" class="button">üìÅ Load Preset Folder</button>
                            <button id="clearAllImages" class="button secondary">üóëÔ∏è Clear All</button>
                        </div>
                        
                        <div class="preset-sections">
                            <!-- Empty state shown initially -->
                            <div id="presetEmptyState" class="preset-empty-state">
                                <div class="empty-state-content">
                                    <div class="empty-state-icon">üì¶</div>
                                    <h4>No Presets Loaded</h4>
                                    <p>Click "Discover Presets" to scan your /presets/ folder and find available preset collections.</p>
                                </div>
                            </div>
                            
                            <!-- Built-in Presets Section (hidden initially) -->
                            <div class="preset-section" id="defaultPresetsSection" style="display: none;">
                                <h4>üì¶ Discovered Presets</h4>
                                <div id="defaultPresetsContainer" class="presets-grid">
                                    <!-- Discovered presets will be populated here -->
                                </div>
                            </div>
                            
                            <!-- External Presets Section -->
                            <div class="preset-section" id="externalPresetsSection" style="display: none;">
                                <h4>üìÅ Loaded Presets</h4>
                                <div id="externalPresetsContainer" class="presets-grid">
                                    <!-- External presets will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="audio-visualizer">
            <div id="volumeLevel" class="volume-meter">
                <div class="level-bar"></div>
            </div>
            <div id="audioStatus">Audio status: inactive</div>
            <div class="mic-test">
                <p>Make LOUDER, SUSTAINED sounds to launch fireworks. Keep making sound to keep them rising. VERY LOUD sounds will BURST all active fireworks! üîä</p>
                <div id="micDetection" class="mic-detection">Make LOUDER, SUSTAINED sound to start fireworks</div>
            </div>
        </div>
    </div>
    
    <!-- Settings panel with tabs -->
    <div id="settingsPanel" class="settings-panel" style="display: none;">
        <h2>Fireworks Settings</h2>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation" role="tablist">
            <button class="tab-button" data-tab="audio" role="tab">üé§ Audio</button>
            <button class="tab-button" data-tab="fireworks" role="tab">üéÜ Fireworks</button>
            <button class="tab-button" data-tab="effects" role="tab">‚ú® Effects</button>
            <button class="tab-button" data-tab="images" role="tab">üñºÔ∏è Images</button>
            <button class="tab-button" data-tab="colors" role="tab">üé® Colors</button>
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Audio & Sound Tab Pane -->
            <div class="tab-pane" id="audio-tab" data-tab-content="audio">
                <h4>üé§ Audio & Sound Settings</h4>
                <div class="setting">
                    <label for="sensitivitySlider">Microphone Sensitivity: <span id="sensitivityValue">2.0</span></label>
                    <input type="range" id="sensitivitySlider" min="0.5" max="4" step="0.1" value="2.0">
                    <p class="setting-description">How sensitive the microphone is to your voice and sounds.</p>
                </div>
                <div class="setting">
                    <label for="thresholdLow">Launch Sensitivity: <span id="thresholdLowValue">0.08</span></label>
                    <input type="range" id="thresholdLow" min="0.02" max="0.2" step="0.01" value="0.08">
                    <p class="setting-description">How quiet your voice can be to still launch fireworks.</p>
                </div>
                <div class="setting">
                    <label for="thresholdHigh">Burst Sensitivity: <span id="thresholdHighValue">0.4</span></label>
                    <input type="range" id="thresholdHigh" min="0.1" max="1" step="0.05" value="0.4">
                    <p class="setting-description">How loud you need to be to explode all fireworks at once.</p>
                </div>
                <div class="setting">
                    <label for="suddenThreshold">Quick Response: <span id="suddenThresholdValue">0.12</span></label>
                    <input type="range" id="suddenThreshold" min="0.05" max="0.3" step="0.01" value="0.12">
                    <p class="setting-description">How quickly the app responds to sudden sounds.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="testSoundEnabled">Test Firework Sounds:</label>
                    <label class="switch">
                        <input type="checkbox" id="testSoundEnabled" checked>
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Play realistic launch and explosion sounds when testing fireworks.</p>
                </div>
                <div class="setting">
                    <label for="testSoundVolume">Sound Volume: <span id="testSoundVolumeValue">0.3</span></label>
                    <input type="range" id="testSoundVolume" min="0" max="1" step="0.05" value="0.3">
                    <p class="setting-description">Volume level for firework sound effects.</p>
                </div>
            </div>

            <!-- Fireworks Tab Pane -->
            <div class="tab-pane" id="fireworks-tab" data-tab-content="fireworks">
                <h4>üéÜ Fireworks Settings</h4>
                <div class="setting">
                    <label for="fireworkSize">Firework Size: <span id="fireworkSizeValue">1.0</span></label>
                    <input type="range" id="fireworkSize" min="0.5" max="5.0" step="0.1" value="1.0">
                    <p class="setting-description">Controls how big fireworks and uploaded images appear during explosions.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="randomFireworkSize">Random Firework Sizes:</label>
                    <label class="switch">
                        <input type="checkbox" id="randomFireworkSize">
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Each firework will have a different random size for more variety.</p>
                </div>
                <div class="setting" id="randomSizeRange" style="display: none;">
                    <label for="randomSizeMin">Smallest Size: <span id="randomSizeMinValue">0.5</span></label>
                    <input type="range" id="randomSizeMin" min="0.5" max="2.0" step="0.1" value="0.5">
                    <p class="setting-description">Minimum size for random fireworks.</p>
                </div>
                <div class="setting" id="randomSizeMaxSetting" style="display: none;">
                    <label for="randomSizeMax">Largest Size: <span id="randomSizeMaxValue">2.0</span></label>
                    <input type="range" id="randomSizeMax" min="2.0" max="5.0" step="0.1" value="2.0">
                    <p class="setting-description">Maximum size for random fireworks.</p>
                </div>
                <div class="setting">
                    <label for="launchHeight">Launch Power: <span id="launchHeightValue">10</span></label>
                    <input type="range" id="launchHeight" min="10" max="100" step="10" value="10">
                    <p class="setting-description">How high and fast fireworks are launched into the sky.</p>
                </div>
                <div class="setting">
                    <label for="maxFireworks">Max Fireworks on Screen: <span id="maxFireworksValue">15</span></label>
                    <input type="range" id="maxFireworks" min="1" max="50" step="1" value="15">
                    <p class="setting-description">Maximum number of fireworks that can be active at the same time.</p>
                </div>
                <div class="setting">
                    <label for="fireworkGravity">Gravity Strength: <span id="gravityValue">0.02</span></label>
                    <input type="range" id="fireworkGravity" min="0.01" max="0.2" step="0.005" value="0.02">
                    <p class="setting-description">How quickly fireworks fall back down (higher = faster falling).</p>
                </div>
                <div class="setting">
                    <label for="smokeTrailIntensity">Smoke Trail: <span id="smokeTrailValue">0.3</span></label>
                    <input type="range" id="smokeTrailIntensity" min="0" max="1" step="0.05" value="0.3">
                    <p class="setting-description">Intensity of the smoke trail behind rising fireworks.</p>
                </div>
            </div>

            <!-- Visual Effects Tab Pane -->
            <div class="tab-pane" id="effects-tab" data-tab-content="effects">
                <h4>‚ú® Visual Effects Settings</h4>
                <div class="setting">
                    <label for="globalSpeed">Animation Speed: <span id="globalSpeedValue">1</span></label>
                    <input type="range" id="globalSpeed" min="0.1" max="2" step="0.1" value="1">
                    <p class="setting-description">Overall speed of all animations (higher = faster, lower = slower motion).</p>
                </div>
                <div class="setting">
                    <label for="particleCount">Explosion Particles: <span id="particleCountValue">100</span></label>
                    <input type="range" id="particleCount" min="10" max="500" step="10" value="100">
                    <p class="setting-description">Number of sparkly particles created when fireworks explode.</p>
                </div>
                <div class="setting">
                    <label for="particleLifespan">Particle Duration: <span id="particleLifespanValue">60</span> frames</label>
                    <input type="range" id="particleLifespan" min="20" max="200" step="5" value="60">
                    <p class="setting-description">How long explosion particles stay visible before fading away.</p>
                </div>
                <div class="setting">
                    <label for="particleMinSize">Smallest Particles: <span id="particleMinSizeValue">1</span></label>
                    <input type="range" id="particleMinSize" min="0.5" max="5" step="0.1" value="1">
                    <p class="setting-description">Minimum size of individual explosion particles.</p>
                </div>
                <div class="setting">
                    <label for="particleMaxSize">Largest Particles: <span id="particleMaxSizeValue">3</span></label>
                    <input type="range" id="particleMaxSize" min="1" max="10" step="0.1" value="3">
                    <p class="setting-description">Maximum size of individual explosion particles.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="useMultiColor">Colorful Particles:</label>
                    <label class="switch">
                         <input type="checkbox" id="useMultiColor">
                         <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Use multiple colors for particles instead of single-color explosions.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="glowEffect">Glow Effect:</label>
                    <label class="switch">
                        <input type="checkbox" id="glowEffect">
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Adds a beautiful glowing aura around fireworks and particles.</p>
                </div>
                <div class="setting">
                    <label for="fadeResistance">Particle Fade Speed: <span id="fadeResistanceValue">0.95</span></label>
                    <input type="range" id="fadeResistance" min="0.8" max="0.99" step="0.01" value="0.95">
                    <p class="setting-description">How quickly particles fade away (higher = slower fading, longer lasting).</p>
                </div>
            </div>

            <!-- Images Tab Pane -->
            <div class="tab-pane" id="images-tab" data-tab-content="images">
                <h4>üñºÔ∏è Image Settings</h4>
                <div class="setting toggle-setting">
                    <label for="backgroundRemovalEnabled">Auto Remove Backgrounds:</label>
                    <label class="switch">
                        <input type="checkbox" id="backgroundRemovalEnabled" checked>
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Automatically remove white/solid backgrounds from uploaded firework images.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="imageRotation">Spinning Images:</label>
                    <label class="switch">
                        <input type="checkbox" id="imageRotation">
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Make uploaded images spin and rotate during firework explosions.</p>
                </div>
                <div class="setting">
                    <label for="imageGravity">Image Gravity: <span id="imageGravityValue">1.0</span></label>
                    <input type="range" id="imageGravity" min="0" max="3" step="0.1" value="1.0">
                    <p class="setting-description">How fast images fall after exploding (0 = float forever, higher = fall faster).</p>
                </div>
                <div class="setting">
                    <label for="bgOpacity">Background Image Opacity: <span id="bgOpacityValue">0.8</span></label>
                    <input type="range" id="bgOpacity" min="0" max="1" step="0.05" value="0.8">
                    <p class="setting-description">How see-through the background slideshow images are (0 = invisible, 1 = solid).</p>
                </div>
                <div class="setting">
                    <label for="bgTransitionTime">Background Transition: <span id="bgTransitionValue">2</span> sec</label>
                    <input type="range" id="bgTransitionTime" min="0.5" max="5" step="0.5" value="2">
                    <p class="setting-description">How long it takes for background images to fade from one to the next.</p>
                </div>
                <div class="setting">
                    <label for="bgDisplayTime">Background Duration: <span id="bgDisplayValue">5</span> sec</label>
                    <input type="range" id="bgDisplayTime" min="2" max="20" step="1" value="5">
                    <p class="setting-description">How long each background image is shown before changing to the next.</p>
                </div>
            </div>
            <div class="tab-pane" id="colors-tab" data-tab-content="colors">
                <h4>üé® Colors & Themes</h4>
                <div class="setting">
                    <label for="colorTheme">Color Theme:</label>
                    <select id="colorTheme">
                        <option value="Vivid" selected>üåà Vivid (Bright & Bold)</option>
                        <option value="Pastel">üå∏ Pastel (Soft & Gentle)</option>
                        <option value="Neon">‚ö° Neon (Electric & Glowing)</option>
                        <option value="Earthy">üçÇ Earthy (Natural & Warm)</option>
                        <option value="Monochrome">‚ö´ Monochrome (Black & White)</option>
                        <option value="Custom">üé® Custom (Your Own Colors)</option>
                    </select>
                    <p class="setting-description">Choose a color style for your fireworks and particles.</p>
                </div>
                <div class="setting">
                    <label for="colorIntensity">Color Intensity: <span id="colorIntensityValue">1</span></label>
                    <input type="range" id="colorIntensity" min="0.1" max="2" step="0.1" value="1">
                    <p class="setting-description">Adjusts the overall vividness of colors.</p>
                </div>
                <div class="setting" id="customColorsSetting" style="display: none;">
                    <h5>Custom Colors</h5>
                    <div class="color-picker-container">
                        <input type="color" id="colorPicker" value="#ff0000">
                        <button id="addColor" class="button">Add Color</button>
                    </div>
                    <p class="setting-description">Click a swatch to remove it.</p>
                    <div id="customColorsList" class="custom-colors-list">
                        <!-- Custom color swatches will be added here by JavaScript -->
                    </div>
                </div>
            </div>

        </div>
        
        <!-- Control Buttons -->
        <div class="settings-controls">
            <button id="resetSettings" class="settings-btn">
                <span class="icon">‚Ü∫</span>
                <span class="text">Reset</span>
            </button>
            <button id="closeSettings" class="settings-btn">
                <span class="icon">‚úì</span>
                <span class="text">Close Settings</span>
            </button>
        </div>
    </div>

    <!-- Tab and button click fixes -->
    
    <!-- Original scripts -->
    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/direct-image-uploader.js"></script>
    <script type="module" src="js/direct-background-uploader.js"></script>
    <script type="module" src="js/ClearManager.js"></script>
    <script type="module" src="js/PresetManager.js"></script>
    <script type="module" src="js/PresetUI.js"></script>
    <script src="js/tab-switcher.js"></script>
    <script src="js/settings-swatch-fix.js"></script>
    
    <script>
        // Direct button handlers
        document.addEventListener('DOMContentLoaded', function() {
            const selectFilesBtn = document.getElementById('selectFiles');
            const fileInput = document.getElementById('fileInput');
            
            if (selectFilesBtn && fileInput) {
                selectFilesBtn.onclick = function() {
                    fileInput.click();
                };
            }
            
            const selectBgFilesBtn = document.getElementById('selectBgFiles');
            const bgFileInput = document.getElementById('bgFileInput');
            
            if (selectBgFilesBtn && bgFileInput) {
                selectBgFilesBtn.onclick = function() {
                    bgFileInput.click();
                };
            }
        });
    </script>
</body>
</html>