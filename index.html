<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>🎵</text></svg>">
    <title>Sound-Responsive Fireworks with Custom Images</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/image-uploader.css">
    <link rel="stylesheet" href="css/background-uploader.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/settings.css">
    <link rel="stylesheet" href="css/uploaders.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/mobile-responsive.css">
    <link rel="stylesheet" href="css/presets.css">
    
</head>
<body>
    <!-- FINAL FIX: Animation canvas must be transparent -->
    <canvas id="backgroundCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none;"></canvas>
    <canvas id="animationCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; background: transparent;"></canvas>
    


    <div class="app-container" style="z-index: 10; background: transparent !important;">
        <!-- Mode Toggle for Mobile - Above control panel -->
        <div class="mobile-mode-toggle">
            <div class="mode-toggle mobile-toggle" tabindex="0" role="switch" aria-label="Toggle between fireworks and bubbles mode">
                <div id="fireworkModeMobile" class="mode-option active" data-mode="firework" title="Fireworks Mode" tabindex="0">🎆</div>
                <div id="bubbleModeMobile" class="mode-option" data-mode="bubble" title="Bubbles Mode" tabindex="0">🫧</div>
                <div class="mode-slider" aria-hidden="true"></div>
            </div>
        </div>
        
        <div class="control-panel">
            <button id="startMicrophone" class="mic-button">
                <span class="icon">🎤</span>
                <span class="text">Start</span>
            </button>
            
            <button id="testFirework" class="test-button">
                <span class="icon">🎆</span>
                <span class="text">Test</span>
            </button>
            
            <button id="toggleSettings">
                <span class="icon">⚙️</span>
                <span class="text">Settings</span>
            </button>
            
            <button id="togglePanels">
                <span class="icon">👁️</span>
                <span class="text">Hide</span>
            </button>
            

        </div>
        
        <!-- Tabbed Uploader Interface -->
        <div class="uploader-tabs-container">
            <div class="uploader-tab-navigation">
                <button class="uploader-tab-button active" data-uploader-tab="firework">Animation Images</button>
                <button class="uploader-tab-button" data-uploader-tab="background">Background Images</button>
                <button class="uploader-tab-button" data-uploader-tab="presets">Presets</button>
                
                <!-- Mode Toggle for Desktop - integrated into tab header -->
                <div class="mode-toggle desktop-toggle" tabindex="0" role="switch" aria-label="Toggle between fireworks and bubbles mode">
                    <div id="fireworkModeDesktop" class="mode-option active" data-mode="firework" title="Fireworks Mode" tabindex="0">🎆</div>
                    <div id="bubbleModeDesktop" class="mode-option" data-mode="bubble" title="Bubbles Mode" tabindex="0">🫧</div>
                    <div class="mode-slider" aria-hidden="true"></div>
                </div>
            </div>
            
            <div class="uploader-tab-content">
                <div class="uploader-tab-pane active" id="firework-tab">
                    <div class="image-upload-container">
                        <div class="upload-area" id="dropZone">
                            <input type="file" id="fileInput" accept="image/*" multiple style="display: none;">
                            <div class="upload-content">
                                <p>Drag and drop custom images here</p>
                                <p>or</p>
                                <button id="selectFiles" class="button">Select Files</button>
                                <p class="file-types">Supported: JPG, PNG, GIF (max 5MB)</p>
                                <p class="file-description">Images will appear during firework explosions and bubble pops</p>
                            </div>
                        </div>
                        <div class="preview-container" id="previewContainer"></div>
                    </div>
                </div>
                
                <div class="uploader-tab-pane" id="background-tab">
                    <div class="image-upload-container">
                        <div class="upload-area" id="bgDropZone">
                            <input type="file" id="bgFileInput" accept="image/*" multiple style="display: none;">
                            <div class="upload-content">
                                <p>Drag and drop background images here</p>
                                <p>or</p>
                                <button id="selectBgFiles" class="button">Select Files</button>
                                <p class="file-types">Supported: JPG, PNG, GIF (max 5MB)</p>
                            </div>
                        </div>
                        
                        <div class="preview-container" id="bgPreviewContainer"></div>
                    </div>
                </div>
                
                <div class="uploader-tab-pane" id="presets-tab">
                    <div class="preset-container">
                        <div class="preset-actions">
                            <button id="discoverPresets" class="button">🔍 Discover Presets</button>
                            <button id="loadExternalPreset" class="button">📁 Load Preset Folder</button>
                            <button id="clearAllImages" class="button secondary">🗑️ Clear All</button>
                        </div>
                        
                        <div class="preset-sections">
                            <!-- Empty state shown initially -->
                            <div id="presetEmptyState" class="preset-empty-state">
                                <div class="empty-state-content">
                                    <div class="empty-state-icon">📦</div>
                                    <h4>No Presets Loaded</h4>
                                    <p>Click "Discover Presets" to scan your /presets/ folder and find available preset collections.</p>
                                </div>
                            </div>
                            
                            <!-- Built-in Presets Section (hidden initially) -->
                            <div class="preset-section" id="defaultPresetsSection" style="display: none;">
                                <h4>📦 Discovered Presets</h4>
                                <div id="defaultPresetsContainer" class="presets-grid">
                                    <!-- Discovered presets will be populated here -->
                                </div>
                            </div>
                            
                            <!-- External Presets Section -->
                            <div class="preset-section" id="externalPresetsSection" style="display: none;">
                                <h4>📁 Loaded Presets</h4>
                                <div id="externalPresetsContainer" class="presets-grid">
                                    <!-- External presets will be populated here -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="audio-visualizer">
            <div id="volumeLevel" class="volume-meter">
                <div class="level-bar"></div>
            </div>
            <div id="audioStatus">Audio status: inactive</div>
            <div class="mic-test">
                <p>Make LOUDER, SUSTAINED sounds to launch animations. Keep making sound to keep them rising. VERY LOUD sounds will trigger all active animations! 🔊</p>
                <div id="micDetection" class="mic-detection">Make LOUDER, SUSTAINED sound to start animations</div>
            </div>
        </div>
    </div>
    
    <!-- Settings panel with tabs -->
    <div id="settingsPanel" class="settings-panel" style="display: none;">
        <h2>Animation Settings</h2>
        
        <!-- Tab Navigation -->
        <div class="tab-navigation" role="tablist">
            <button class="tab-button" data-tab="audio" role="tab">🎤 Audio</button>
            <button class="tab-button" data-tab="fireworks" role="tab">🎆 Fireworks</button>
            <button class="tab-button" data-tab="bubbles" role="tab">🫧 Bubbles</button>
            <button class="tab-button" data-tab="effects" role="tab">✨ Effects</button>
            <button class="tab-button" data-tab="images" role="tab">🖼️ Images</button>
            <button class="tab-button" data-tab="colors" role="tab">🎨 Colors</button>
        </div>
        
        <!-- Tab Content -->
        <div class="tab-content">
            <!-- Audio & Sound Tab Pane -->
            <div class="tab-pane" id="audio-tab" data-tab-content="audio">
                <h4>🎤 Audio & Sound Settings</h4>
                <div class="setting">
                    <label for="sensitivitySlider">Microphone Sensitivity: <span id="sensitivityValue">2.0</span></label>
                    <input type="range" id="sensitivitySlider" min="0.5" max="4" step="0.1" value="2.0">
                    <p class="setting-description">How sensitive the microphone is to your voice and sounds.</p>
                </div>
                <div class="setting">
                    <label for="thresholdLow">Launch Sensitivity: <span id="thresholdLowValue">0.08</span></label>
                    <input type="range" id="thresholdLow" min="0.02" max="0.2" step="0.01" value="0.08">
                    <p class="setting-description">How quiet your voice can be to still launch fireworks.</p>
                </div>
                <div class="setting">
                    <label for="thresholdHigh">Burst Sensitivity: <span id="thresholdHighValue">0.18</span></label>
                    <input type="range" id="thresholdHigh" min="0.1" max="1" step="0.05" value="0.18">
                    <p class="setting-description">How loud you need to be to explode all bubbles at once.</p>
                </div>
                <div class="setting">
                    <label for="suddenThreshold">Quick Response: <span id="suddenThresholdValue">0.12</span></label>
                    <input type="range" id="suddenThreshold" min="0.05" max="0.3" step="0.01" value="0.12">
                    <p class="setting-description">How quickly the app responds to sudden sounds.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="testSoundEnabled">Test Animation Sounds:</label>
                    <label class="switch">
                        <input type="checkbox" id="testSoundEnabled" checked>
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Play realistic launch and explosion sounds when testing animations (fireworks/bubbles).</p>
                </div>
                <div class="setting">
                    <label for="testSoundVolume">Sound Volume: <span id="testSoundVolumeValue">0.3</span></label>
                    <input type="range" id="testSoundVolume" min="0" max="1" step="0.05" value="0.3">
                    <p class="setting-description">Volume level for animation sound effects.</p>
                </div>
            </div>

            <!-- Fireworks Tab Pane -->
            <div class="tab-pane" id="fireworks-tab" data-tab-content="fireworks">
                <h4>🎆 Fireworks Settings</h4>
                
                <!-- Launch Controls Section -->
                <div class="settings-section launch-controls-section">
                    <h4 class="section-title">🚀 Launch Controls</h4>
                    
                    <!-- Launch Position Settings -->
                    <div class="setting-group">
                        <h5 class="group-title">🎯 Launch Position</h5>
                        
                        <div class="setting">
                            <label for="launchSpreadMode">Position Mode:</label>
                            <select id="launchSpreadMode" class="setting-select">
                                <option value="center">Center Only</option>
                                <option value="range" selected>Range from Center</option>
                                <option value="random">Random Across Screen</option>
                            </select>
                            <p class="setting-description">How fireworks are positioned along the bottom of the screen</p>
                        </div>
                        
                        <div class="setting" id="launchSpreadSetting">
                            <label for="launchSpread">Launch Spread: <span id="launchSpreadValue">20</span>%</label>
                            <input type="range" id="launchSpread" min="0" max="100" step="5" value="20" class="setting-slider">
                            <div class="range-labels">
                                <span>Center Only</span>
                                <span>Full Width</span>
                            </div>
                            <p class="setting-description">Width of the launch zone (0% = center point, 100% = entire screen width)</p>
                        </div>
                    </div>

                    <!-- Launch Angle Settings -->
                    <div class="setting-group">
                        <h5 class="group-title">📐 Launch Angle</h5>
                        
                        <div class="setting">
                            <label for="launchAngleMode">Angle Mode:</label>
                            <select id="launchAngleMode" class="setting-select">
                                <option value="range" selected>Angle Range</option>
                                <option value="fixed">Fixed Angle</option>
                                <option value="random">Random Angle</option>
                            </select>
                            <p class="setting-description">How launch angles are determined</p>
                        </div>
                        
                        <div class="setting" id="launchAngleRangeSetting">
                            <label for="launchAngleCenter">Center Angle: <span id="launchAngleCenterValue">90</span>°</label>
                            <input type="range" id="launchAngleCenter" min="45" max="135" step="5" value="90" class="setting-slider">
                            <div class="range-labels">
                                <span>45° (Right)</span>
                                <span>90° (Up)</span>
                                <span>135° (Left)</span>
                            </div>
                            <p class="setting-description">The main direction fireworks will launch toward</p>
                        </div>
                        
                        <div class="setting" id="launchAngleSpreadSetting">
                            <label for="launchAngleSpread">Angle Spread: <span id="launchAngleSpreadValue">30</span>°</label>
                            <input type="range" id="launchAngleSpread" min="0" max="45" step="5" value="30" class="setting-slider">
                            <div class="range-labels">
                                <span>0° (Precise)</span>
                                <span>45° (Wide Variety)</span>
                            </div>
                            <p class="setting-description">How much angles can vary from the center (±spread)</p>
                        </div>
                        
                        <div class="setting" id="launchAngleFixedSetting" style="display: none;">
                            <label for="launchAngleFixed">Fixed Angle: <span id="launchAngleFixedValue">90</span>°</label>
                            <input type="range" id="launchAngleFixed" min="45" max="165" step="5" value="90" class="setting-slider">
                            <div class="range-labels">
                                <span>45° (Right)</span>
                                <span>90° (Straight Up)</span>
                                <span>135° (Left)</span>
                            </div>
                            <p class="setting-description">Fixed launch angle for all fireworks</p>
                        </div>
                    </div>

                    <!-- Launch Power Settings -->
                    <div class="setting-group">
                        <h5 class="group-title">🚀 Launch Power</h5>
                        
                        <div class="setting">
                            <label for="launchHeight">Launch Power: <span id="launchHeightValue">60</span>%</label>
                            <input type="range" id="launchHeight" min="10" max="100" step="5" value="60" class="setting-slider">
                            <div class="range-labels">
                                <span>10% (Low)</span>
                                <span>100% (High)</span>
                            </div>
                            <p class="setting-description">How high fireworks reach (10% = 10% of screen height, 100% = 90% of screen height)</p>
                        </div>
                        
                        <div class="setting toggle-setting">
                            <label for="randomLaunchPower">Random Launch Power:</label>
                            <label class="switch">
                                <input type="checkbox" id="randomLaunchPower" checked>
                                <span class="slider round"></span>
                            </label>
                            <p class="setting-description">Each firework will have a different random launch power for more variety.</p>
                        </div>
                        
                        <div class="setting" id="randomLaunchPowerRange" style="display: none;">
                            <label for="randomLaunchPowerMin">Minimum Power: <span id="randomLaunchPowerMinValue">30</span>%</label>
                            <input type="range" id="randomLaunchPowerMin" min="10" max="80" step="5" value="30" class="setting-slider">
                            <div class="range-labels">
                                <span>10% (Very Low)</span>
                                <span>80% (High)</span>
                            </div>
                            <p class="setting-description">Minimum launch power for random fireworks.</p>
                        </div>
                        
                        <div class="setting" id="randomLaunchPowerMaxSetting" style="display: none;">
                            <label for="randomLaunchPowerMax">Maximum Power: <span id="randomLaunchPowerMaxValue">90</span>%</label>
                            <input type="range" id="randomLaunchPowerMax" min="20" max="100" step="5" value="90" class="setting-slider">
                            <div class="range-labels">
                                <span>20% (Low)</span>
                                <span>100% (Maximum)</span>
                            </div>
                            <p class="setting-description">Maximum launch power for random fireworks.</p>
                        </div>
                    </div>

                    <!-- Launch Presets -->
                    <div class="setting-group">
                        <h5 class="group-title">⚡ Quick Presets</h5>
                        
                        <div class="setting">
                            <label for="launchPreset">Launch Pattern:</label>
                            <select id="launchPreset" class="setting-select">
                                <option value="">-- Select Preset --</option>
                                <option value="classic">🎆 Classic (Center, Slight Spread)</option>
                                <option value="wide-celebration">🎉 Wide Celebration (Full Screen)</option>
                                <option value="fountain">⛲ Fountain (Center, Wide Angles)</option>
                                <option value="rocket-straight">🚀 Straight Rockets (Vertical Only)</option>
                                <option value="left-cascade">↖️ Left Cascade</option>
                                <option value="right-cascade">↗️ Right Cascade</option>
                                <option value="chaos">🌪️ Chaos Mode (Random Everything)</option>
                            </select>
                            <p class="setting-description" id="presetDescription">Choose a preset to quickly configure launch settings</p>
                        </div>
                    </div>
                </div>
                
                <!-- Firework Appearance Section -->
                <div class="settings-section">
                    <h4 class="section-title">✨ Firework Appearance</h4>
                    
                    <div class="setting-group">
                        <h5 class="group-title">📏 Size Settings</h5>
                        
                        <div class="setting">
                            <label for="fireworkSize">Firework Size: <span id="fireworkSizeValue">1.0</span></label>
                            <input type="range" id="fireworkSize" min="0.5" max="5.0" step="0.1" value="1.0">
                            <p class="setting-description">Controls how big fireworks and uploaded images appear during explosions.</p>
                        </div>
                        
                        <div class="setting toggle-setting">
                            <label for="randomFireworkSize">Random Firework Sizes:</label>
                            <label class="switch">
                                <input type="checkbox" id="randomFireworkSize">
                                <span class="slider round"></span>
                            </label>
                            <p class="setting-description">Each firework will have a different random size for more variety.</p>
                        </div>
                        
                        <div class="setting" id="randomSizeRange" style="display: none;">
                            <label for="randomSizeMin">Smallest Size: <span id="randomSizeMinValue">0.5</span></label>
                            <input type="range" id="randomSizeMin" min="0.5" max="2.0" step="0.1" value="0.5">
                            <p class="setting-description">Minimum size for random fireworks.</p>
                        </div>
                        
                        <div class="setting" id="randomSizeMaxSetting" style="display: none;">
                            <label for="randomSizeMax">Largest Size: <span id="randomSizeMaxValue">2.0</span></label>
                            <input type="range" id="randomSizeMax" min="2.0" max="5.0" step="0.1" value="2.0">
                            <p class="setting-description">Maximum size for random fireworks.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Physics & Behavior Section -->
                <div class="settings-section">
                    <h4 class="section-title">⚙️ Physics & Behavior</h4>
                    
                    <div class="setting-group">
                        <h5 class="group-title">🌍 Physics Settings</h5>
                        
                        <div class="setting">
                            <label for="maxFireworks">Max Fireworks on Screen: <span id="maxFireworksValue">15</span></label>
                            <input type="range" id="maxFireworks" min="1" max="50" step="1" value="15">
                            <p class="setting-description">Maximum number of fireworks that can be active at the same time.</p>
                        </div>
                        
                        <div class="setting">
                            <label for="fireworkGravity">Gravity Strength: <span id="gravityValue">0.035</span></label>
                            <input type="range" id="fireworkGravity" min="0.01" max="0.2" step="0.005" value="0.035">
                            <p class="setting-description">How quickly fireworks fall back down (higher = faster falling).</p>
                        </div>
                        
                        <div class="setting">
                            <label for="smokeTrailIntensity">Smoke Trail: <span id="smokeTrailValue">0.3</span></label>
                            <input type="range" id="smokeTrailIntensity" min="0" max="1" step="0.05" value="0.3">
                            <p class="setting-description">Intensity of the smoke trail behind rising fireworks.</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Bubbles Tab Pane -->
            <div class="tab-pane" id="bubbles-tab" data-tab-content="bubbles">
                <h4>🫧 Bubble Settings</h4>
                
                <!-- Launch Controls Section -->
                <div class="settings-section launch-controls-section">
                    <h4 class="section-title">🚀 Launch Controls</h4>
                    
                    <!-- Launch Position Settings -->
                    <div class="setting-group">
                        <h5 class="group-title">🎯 Launch Position</h5>
                        
                        <div class="setting">
                            <label for="bubbleLaunchSpreadMode">Position Mode:</label>
                            <select id="bubbleLaunchSpreadMode" class="setting-select">
                                <option value="center">Center Only</option>
                                <option value="range" selected>Range from Center</option>
                                <option value="random">Random Across Screen</option>
                            </select>
                            <p class="setting-description">How bubbles are positioned along the bottom of the screen</p>
                        </div>
                        
                        <div class="setting" id="bubbleLaunchSpreadSetting">
                            <label for="bubbleLaunchSpread">Launch Spread: <span id="bubbleLaunchSpreadValue">30</span>%</label>
                            <input type="range" id="bubbleLaunchSpread" min="0" max="100" step="5" value="30" class="setting-slider">
                            <div class="range-labels">
                                <span>Center Only</span>
                                <span>Full Width</span>
                            </div>
                            <p class="setting-description">Width of the launch zone (0% = center point, 100% = entire screen width)</p>
                        </div>
                    </div>

                    <!-- Cluster Settings -->
                    <div class="setting-group">
                        <h5 class="group-title">🫧 Cluster Settings</h5>
                        
                        <div class="setting">
                            <label for="bubbleClusterSize">Bubbles per Launch: <span id="bubbleClusterSizeValue">2</span></label>
                            <input type="range" id="bubbleClusterSize" min="0" max="8" step="1" value="2" class="setting-slider">
                            <div class="range-labels">
                                <span>0 (None)</span>
                                <span>8 (Large Cluster)</span>
                            </div>
                            <p class="setting-description">Number of bubbles created each time you launch</p>
                        </div>
                        
                        <div class="setting toggle-setting">
                            <label for="randomBubbleClusterSize">Random Bubbles per Launch:</label>
                            <label class="switch">
                                <input type="checkbox" id="randomBubbleClusterSize">
                                <span class="slider round"></span>
                            </label>
                            <p class="setting-description">Each launch will create a random number of bubbles for more variety.</p>
                        </div>
                        
                        <div class="setting" id="randomClusterSizeRange" style="display: none;">
                            <label for="randomClusterSizeMin">Minimum Bubbles: <span id="randomClusterSizeMinValue">1</span></label>
                            <input type="range" id="randomClusterSizeMin" min="1" max="5" step="1" value="1" class="setting-slider">
                            <div class="range-labels">
                                <span>1 (Single)</span>
                                <span>5 (Medium)</span>
                            </div>
                            <p class="setting-description">Minimum number of bubbles per launch.</p>
                        </div>
                        
                        <div class="setting" id="randomClusterSizeMaxSetting" style="display: none;">
                            <label for="randomClusterSizeMax">Maximum Bubbles: <span id="randomClusterSizeMaxValue">6</span></label>
                            <input type="range" id="randomClusterSizeMax" min="3" max="8" step="1" value="6" class="setting-slider">
                            <div class="range-labels">
                                <span>3 (Small)</span>
                                <span>8 (Large Cluster)</span>
                            </div>
                            <p class="setting-description">Maximum number of bubbles per launch.</p>
                        </div>
                        
                        <div class="setting">
                            <label for="bubbleClusterSpread">Cluster Spread: <span id="bubbleClusterSpreadValue">20</span>px</label>
                            <input type="range" id="bubbleClusterSpread" min="5" max="100" step="5" value="20" class="setting-slider">
                            <div class="range-labels">
                                <span>5px (Tight)</span>
                                <span>100px (Wide)</span>
                            </div>
                            <p class="setting-description">How spread out bubbles are within each cluster</p>
                        </div>
                    </div>

                    <!-- Rise Speed Settings -->
                    <div class="setting-group">
                        <h5 class="group-title">⬆️ Rise Speed</h5>
                        
                        <div class="setting">
                            <label for="bubbleRiseSpeed">Base Rise Speed: <span id="bubbleRiseSpeedValue">2.0</span></label>
                            <input type="range" id="bubbleRiseSpeed" min="0.5" max="5.0" step="0.1" value="2.0" class="setting-slider">
                            <div class="range-labels">
                                <span>0.5 (Slow Float)</span>
                                <span>5.0 (Fast Rise)</span>
                            </div>
                            <p class="setting-description">Base speed at which bubbles float upward</p>
                        </div>
                        
                        <div class="setting toggle-setting">
                            <label for="randomBubbleRiseSpeed">Random Rise Speeds:</label>
                            <label class="switch">
                                <input type="checkbox" id="randomBubbleRiseSpeed">
                                <span class="slider round"></span>
                            </label>
                            <p class="setting-description">Each bubble will have a different random rise speed for more variety.</p>
                        </div>
                        
                        <div class="setting" id="randomRiseSpeedRange" style="display: none;">
                            <label for="randomRiseSpeedMin">Minimum Speed: <span id="randomRiseSpeedMinValue">1.0</span></label>
                            <input type="range" id="randomRiseSpeedMin" min="0.5" max="3.0" step="0.1" value="1.0" class="setting-slider">
                            <div class="range-labels">
                                <span>0.5 (Very Slow)</span>
                                <span>3.0 (Fast)</span>
                            </div>
                            <p class="setting-description">Minimum rise speed for random bubbles.</p>
                        </div>
                        
                        <div class="setting" id="randomRiseSpeedMaxSetting" style="display: none;">
                            <label for="randomRiseSpeedMax">Maximum Speed: <span id="randomRiseSpeedMaxValue">4.0</span></label>
                            <input type="range" id="randomRiseSpeedMax" min="2.0" max="5.0" step="0.1" value="4.0" class="setting-slider">
                            <div class="range-labels">
                                <span>2.0 (Moderate)</span>
                                <span>5.0 (Very Fast)</span>
                            </div>
                            <p class="setting-description">Maximum rise speed for random bubbles.</p>
                        </div>
                    </div>

                    <!-- Quick Presets -->
                    <div class="setting-group">
                        <h5 class="group-title">⚡ Quick Presets</h5>
                        
                        <div class="setting">
                            <label for="bubblePreset">Bubble Pattern:</label>
                            <select id="bubblePreset" class="setting-select">
                                <option value="">-- Select Preset --</option>
                                <option value="gentle">🫧 Gentle (Small Clusters, Slow Rise)</option>
                                <option value="celebration">🎉 Celebration (Large Clusters, Fast Rise)</option>
                                <option value="fountain">⛲ Fountain (Center, Many Bubbles)</option>
                                <option value="stream">🌊 Stream (Single Line, Steady)</option>
                                <option value="chaos">🌪️ Chaos Mode (Random Everything)</option>
                                <option value="peaceful">🕊️ Peaceful (Slow, Spread Out)</option>
                                <option value="party">🎊 Party (Fast, Everywhere)</option>
                            </select>
                            <p class="setting-description" id="bubblePresetDescription">Choose a preset to quickly configure bubble settings</p>
                        </div>
                    </div>
                </div>
                
                <!-- Bubble Appearance Section -->
                <div class="settings-section">
                    <h4 class="section-title">✨ Bubble Appearance</h4>
                    
                    <div class="setting-group">
                        <h5 class="group-title">📏 Size Settings</h5>
                        
                        <div class="setting">
                            <label for="bubbleSize">Bubble Size: <span id="bubbleSizeValue">1.0</span></label>
                            <input type="range" id="bubbleSize" min="0.5" max="3.0" step="0.1" value="1.0">
                            <p class="setting-description">Controls how big bubbles and uploaded images appear during pops.</p>
                        </div>
                        
                        <div class="setting toggle-setting">
                            <label for="randomBubbleSize">Random Bubble Sizes:</label>
                            <label class="switch">
                                <input type="checkbox" id="randomBubbleSize">
                                <span class="slider round"></span>
                            </label>
                            <p class="setting-description">Each bubble will have a different random size for more variety.</p>
                        </div>
                        
                        <div class="setting" id="randomBubbleSizeRange" style="display: none;">
                            <label for="randomBubbleSizeMin">Smallest Size: <span id="randomBubbleSizeMinValue">0.5</span></label>
                            <input type="range" id="randomBubbleSizeMin" min="0.5" max="2.0" step="0.1" value="0.5">
                            <p class="setting-description">Minimum size for random bubbles.</p>
                        </div>
                        
                        <div class="setting" id="randomBubbleSizeMaxSetting" style="display: none;">
                            <label for="randomBubbleSizeMax">Largest Size: <span id="randomBubbleSizeMaxValue">2.0</span></label>
                            <input type="range" id="randomBubbleSizeMax" min="2.0" max="5.0" step="0.1" value="2.0">
                            <p class="setting-description">Maximum size for random bubbles.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Pop Behavior Section -->
                <div class="settings-section">
                    <h4 class="section-title">💥 Pop Behavior</h4>
                    
                    <div class="setting-group">
                        <h5 class="group-title">🎯 Test Bubble Pop Height Settings</h5>
                        
                        <div class="setting">
                            <label for="bubbleAutoPopHeight">Test Bubble Auto-Pop Height: <span id="bubbleAutoPopHeightValue">85</span>%</label>
                            <input type="range" id="bubbleAutoPopHeight" min="10" max="100" step="5" value="85" class="setting-slider">
                            <div class="range-labels">
                                <span>10% (Low in Sky)</span>
                                <span>100% (High in Sky)</span>
                            </div>
                            <p class="setting-description">Height where TEST BUBBLES automatically pop (10% = low in sky, 100% = high in sky)</p>
                        </div>
                        
                        <div class="setting toggle-setting">
                            <label for="randomBubblePopHeight">Random Test Bubble Pop Heights:</label>
                            <label class="switch">
                                <input type="checkbox" id="randomBubblePopHeight">
                                <span class="slider round"></span>
                            </label>
                            <p class="setting-description">Each test bubble will pop at a different random height for more variety.</p>
                        </div>
                        
                        <div class="setting" id="randomPopHeightRange" style="display: none;">
                            <label for="randomPopHeightMin">Minimum Pop Height: <span id="randomPopHeightMinValue">70</span>%</label>
                            <input type="range" id="randomPopHeightMin" min="10" max="80" step="5" value="70" class="setting-slider">
                            <div class="range-labels">
                                <span>10% (Low)</span>
                                <span>80% (High)</span>
                            </div>
                            <p class="setting-description">Minimum pop height for random test bubbles (lower = closer to ground).</p>
                        </div>
                        
                        <div class="setting" id="randomPopHeightMaxSetting" style="display: none;">
                            <label for="randomPopHeightMax">Maximum Pop Height: <span id="randomPopHeightMaxValue">100</span>%</label>
                            <input type="range" id="randomPopHeightMax" min="30" max="100" step="5" value="100" class="setting-slider">
                            <div class="range-labels">
                                <span>30% (Moderate)</span>
                                <span>100% (Very High)</span>
                            </div>
                            <p class="setting-description">Maximum pop height for random test bubbles (higher = closer to top).</p>
                        </div>
                    </div>
                    
                    <div class="setting-group">
                        <h5 class="group-title">⚙️ Pop Settings</h5>
                        
                        <div class="setting">
                            <label for="maxBubbles">Max Bubbles on Screen: <span id="maxBubblesValue">15</span></label>
                            <input type="range" id="maxBubbles" min="5" max="50" step="1" value="15">
                            <p class="setting-description">Maximum number of bubbles that can be active at the same time.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Physics & Behavior Section -->
                <div class="settings-section">
                    <h4 class="section-title">⚙️ Physics & Behavior</h4>
                    
                    <div class="setting-group">
                        <h5 class="group-title">🌍 Physics Settings</h5>
                        
                        <div class="setting">
                            <label for="bubbleGravity">Bubble Gravity: <span id="bubbleGravityValue">0.015</span></label>
                            <input type="range" id="bubbleGravity" min="0.005" max="0.05" step="0.005" value="0.015">
                            <p class="setting-description">How much gravity affects bubbles (higher = fall faster).</p>
                        </div>
                        
                        <div class="setting">
                            <label for="bubbleWobble">Wobble Intensity: <span id="bubbleWobbleValue">1.0</span></label>
                            <input type="range" id="bubbleWobble" min="0" max="3.0" step="0.1" value="1.0">
                            <p class="setting-description">How much bubbles wobble as they float (0 = straight up).</p>
                        </div>
                        
                        <div class="setting">
                            <label for="bubbleBuoyancy">Buoyancy: <span id="bubbleBuoyancyValue">0.98</span></label>
                            <input type="range" id="bubbleBuoyancy" min="0.9" max="1.0" step="0.01" value="0.98">
                            <p class="setting-description">How well bubbles resist gravity (higher = float better).</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Visual Effects Tab Pane -->
            <div class="tab-pane" id="effects-tab" data-tab-content="effects">
                <h4>✨ Visual Effects Settings</h4>
                <div class="setting">
                    <label for="globalSpeed">Animation Speed: <span id="globalSpeedValue">1</span></label>
                    <input type="range" id="globalSpeed" min="0.1" max="2" step="0.1" value="1">
                    <p class="setting-description">Overall speed of all animations (higher = faster, lower = slower motion).</p>
                </div>
                <div class="setting">
                    <label for="particleCount">Explosion Particles: <span id="particleCountValue">100</span></label>
                    <input type="range" id="particleCount" min="10" max="500" step="10" value="100">
                    <p class="setting-description">Number of sparkly particles created when fireworks explode.</p>
                </div>
                <div class="setting">
                    <label for="particleLifespan">Particle Duration: <span id="particleLifespanValue">60</span> frames</label>
                    <input type="range" id="particleLifespan" min="20" max="200" step="5" value="60">
                    <p class="setting-description">How long explosion particles stay visible before fading away.</p>
                </div>
                <div class="setting">
                    <label for="particleMinSize">Smallest Particles: <span id="particleMinSizeValue">1</span></label>
                    <input type="range" id="particleMinSize" min="0.5" max="5" step="0.1" value="1">
                    <p class="setting-description">Minimum size of individual explosion particles.</p>
                </div>
                <div class="setting">
                    <label for="particleMaxSize">Largest Particles: <span id="particleMaxSizeValue">3</span></label>
                    <input type="range" id="particleMaxSize" min="1" max="10" step="0.1" value="3">
                    <p class="setting-description">Maximum size of individual explosion particles.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="useMultiColor">Colorful Particles:</label>
                    <label class="switch">
                         <input type="checkbox" id="useMultiColor">
                         <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Use multiple colors for particles instead of single-color explosions.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="glowEffect">Glow Effect:</label>
                    <label class="switch">
                        <input type="checkbox" id="glowEffect">
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Adds a beautiful glowing aura around fireworks and particles.</p>
                </div>
                <div class="setting">
                    <label for="fadeResistance">Particle Fade Speed: <span id="fadeResistanceValue">0.95</span></label>
                    <input type="range" id="fadeResistance" min="0.8" max="0.99" step="0.01" value="0.95">
                    <p class="setting-description">How quickly particles fade away (higher = slower fading, longer lasting).</p>
                </div>
            </div>

            <!-- Images Tab Pane -->
            <div class="tab-pane" id="images-tab" data-tab-content="images">
                <h4>🖼️ Image Settings</h4>
                <div class="setting toggle-setting">
                    <label for="backgroundRemovalEnabled">Auto Remove Backgrounds:</label>
                    <label class="switch">
                        <input type="checkbox" id="backgroundRemovalEnabled" checked>
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Automatically remove white/solid backgrounds from uploaded firework images.</p>
                </div>
                <div class="setting toggle-setting">
                    <label for="imageRotation">Spinning Images:</label>
                    <label class="switch">
                        <input type="checkbox" id="imageRotation">
                        <span class="slider round"></span>
                    </label>
                    <p class="setting-description">Make uploaded images spin and rotate during firework explosions.</p>
                </div>
                <div class="setting">
                    <label for="imageGravity">Image Gravity: <span id="imageGravityValue">1.0</span></label>
                    <input type="range" id="imageGravity" min="0" max="3" step="0.1" value="1.0">
                    <p class="setting-description">How fast images fall after exploding (0 = float forever, higher = fall faster).</p>
                </div>
                <div class="setting">
                    <label for="bgOpacity">Background Image Opacity: <span id="bgOpacityValue">0.8</span></label>
                    <input type="range" id="bgOpacity" min="0" max="1" step="0.05" value="0.8">
                    <p class="setting-description">How see-through the background slideshow images are (0 = invisible, 1 = solid).</p>
                </div>
                <div class="setting">
                    <label for="bgTransitionTime">Background Transition: <span id="bgTransitionValue">2</span> sec</label>
                    <input type="range" id="bgTransitionTime" min="0.5" max="5" step="0.5" value="2">
                    <p class="setting-description">How long it takes for background images to fade from one to the next.</p>
                </div>
                <div class="setting">
                    <label for="bgDisplayTime">Background Duration: <span id="bgDisplayValue">5</span> sec</label>
                    <input type="range" id="bgDisplayTime" min="2" max="20" step="1" value="5">
                    <p class="setting-description">How long each background image is shown before changing to the next.</p>
                </div>
            </div>
            <div class="tab-pane" id="colors-tab" data-tab-content="colors">
                <h4>🎨 Colors & Themes</h4>
                <div class="setting">
                    <label for="colorTheme">Color Theme:</label>
                    <select id="colorTheme">
                        <option value="Vivid" selected>🌈 Vivid (Bright & Bold)</option>
                        <option value="Pastel">🌸 Pastel (Soft & Gentle)</option>
                        <option value="Neon">⚡ Neon (Electric & Glowing)</option>
                        <option value="Earthy">🍂 Earthy (Natural & Warm)</option>
                        <option value="Monochrome">⚫ Monochrome (Black & White)</option>
                        <option value="Custom">🎨 Custom (Your Own Colors)</option>
                    </select>
                    <p class="setting-description">Choose a color style for your fireworks and particles.</p>
                </div>
                <div class="setting">
                    <label for="colorIntensity">Color Intensity: <span id="colorIntensityValue">1</span></label>
                    <input type="range" id="colorIntensity" min="0.1" max="2" step="0.1" value="1">
                    <p class="setting-description">Adjusts the overall vividness of colors.</p>
                </div>
                <div class="setting" id="customColorsSetting" style="display: none;">
                    <h5>Custom Colors</h5>
                    <div class="color-picker-container">
                        <input type="color" id="colorPicker" value="#ff0000">
                        <button id="addColor" class="button">Add Color</button>
                    </div>
                    <p class="setting-description">Click a swatch to remove it.</p>
                    <div id="customColorsList" class="custom-colors-list">
                        <!-- Custom color swatches will be added here by JavaScript -->
                    </div>
                </div>
            </div>

        </div>
        
        <!-- Control Buttons -->
        <div class="settings-controls">
            <button id="resetSettings" class="settings-btn">
                <span class="icon">↺</span>
                <span class="text">Reset</span>
            </button>
            <button id="closeSettings" class="settings-btn">
                <span class="icon">✓</span>
                <span class="text">Close Settings</span>
            </button>
        </div>
    </div>

    <!-- Tab and button click fixes -->
    
    <!-- Original scripts -->
    <script type="module" src="js/main.js"></script>
    <script type="module" src="js/direct-image-uploader.js"></script>
    <script type="module" src="js/direct-background-uploader.js"></script>
    <script type="module" src="js/ClearManager.js"></script>
    <script type="module" src="js/PresetManager.js"></script>
    <script type="module" src="js/PresetUI.js"></script>
    <script src="js/tab-switcher.js"></script>
    <script src="js/settings-swatch-fix.js"></script>
    
    <script>
        // Direct button handlers
        document.addEventListener('DOMContentLoaded', function() {
            const selectFilesBtn = document.getElementById('selectFiles');
            const fileInput = document.getElementById('fileInput');
            
            if (selectFilesBtn && fileInput) {
                selectFilesBtn.onclick = function() {
                    fileInput.click();
                };
            }
            
            const selectBgFilesBtn = document.getElementById('selectBgFiles');
            const bgFileInput = document.getElementById('bgFileInput');
            
            if (selectBgFilesBtn && bgFileInput) {
                selectBgFilesBtn.onclick = function() {
                    bgFileInput.click();
                };
            }
        });
    </script>
</body>
</html>